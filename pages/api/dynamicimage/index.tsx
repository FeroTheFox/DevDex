/* eslint-disable @next/next/no-img-element */
import { ImageResponse } from '@vercel/og'
import { NextRequest } from 'next/server'

export const config = {
  runtime: 'experimental-edge',
}

export default (req: NextRequest) => {
  const { searchParams } = req.nextUrl

  const username = searchParams.get('username')

  if (!username)
    return new ImageResponse(<>Missing &quot;?username&quot; param</>, {
      width: 1200,
      height: 630,
    })

  return new ImageResponse(
    (
      <div tw='flex h-full w-full items-start justify-start bg-[#0f1115]'>
        <div tw='flex h-full items-start justify-start'>
          <div tw='relative flex h-full w-full items-center justify-center'>
            <div tw='text-white mx-20 flex flex-col items-center justify-center text-center text-[60px] font-bold'>
              <img
                alt='avatar'
                width='256'
                height='256'
                tw='rounded-full'
                src={`https://github.com/${username}.png`}
              />
              <div tw='mt-12 flex flex-row items-center'>
                <span tw='mr-4 mb-2'>{username} on</span>
                <svg
                  width='214'
                  height='64'
                  viewBox='0 0 214 64'
                  fill='none'
                  xmlns='http://www.w3.org/2000/svg'
                >
                  <g clipPath='url(#clip0_160_3)'>
                    <g filter='url(#filter0_d_160_3)'>
                      <path
                        fillRule='evenodd'
                        clipRule='evenodd'
                        d='M19.25 12.125C17.5931 12.125 16.25 13.4681 16.25 15.125V48.875C16.25 50.5319 17.5931 51.875 19.25 51.875H24.75C26.4069 51.875 27.75 50.5319 27.75 48.875C27.75 47.2181 26.4069 45.875 24.75 45.875H22.25V18.125H24.75C26.4069 18.125 27.75 16.7819 27.75 15.125C27.75 13.4681 26.4069 12.125 24.75 12.125H19.25ZM33 12.125C31.3431 12.125 30 13.4681 30 15.125C30 15.3252 30.0196 15.5208 30.057 15.71C30.3279 17.0807 31.5326 18.1158 32.9807 18.1249C32.987 18.1251 33.0042 18.1255 33.0318 18.1266C33.0891 18.129 33.1902 18.1343 33.3288 18.1465C33.6071 18.1709 34.0296 18.2219 34.5472 18.3278C35.5927 18.5417 36.9604 18.9657 38.306 19.7913C40.8057 21.3253 43.75 24.5473 43.75 32C43.75 39.4527 40.8057 42.6747 38.306 44.2087C36.9604 45.0343 35.5927 45.4583 34.5472 45.6722C34.0296 45.7781 33.6071 45.8291 33.3288 45.8535C33.1902 45.8657 33.0891 45.871 33.0318 45.8734C33.017 45.874 33.0052 45.8744 32.9965 45.8746C32.9893 45.8749 32.9841 45.875 32.9811 45.875C31.333 45.8852 30 47.2244 30 48.875C30 50.5319 31.3431 51.875 33 51.875V48.875C33 51.875 33.0019 51.875 33.0038 51.875L33.0078 51.875L33.017 51.875L33.0392 51.8748C33.0557 51.8746 33.0756 51.8744 33.0988 51.8739C33.1452 51.873 33.2049 51.8713 33.277 51.8684C33.4211 51.8625 33.6154 51.8514 33.8528 51.8306C34.3265 51.7891 34.9782 51.7083 35.7496 51.5505C37.2823 51.237 39.3521 50.6063 41.444 49.3226C45.8193 46.6378 49.75 41.4223 49.75 32C49.75 22.5777 45.8193 17.3622 41.444 14.6774C39.3521 13.3937 37.2823 12.763 35.7496 12.4495C34.9782 12.2917 34.3265 12.2109 33.8528 12.1694C33.6154 12.1486 33.4211 12.1375 33.277 12.1316C33.2049 12.1287 33.1452 12.127 33.0988 12.1261C33.0756 12.1256 33.0557 12.1254 33.0392 12.1252L33.017 12.125L33.0078 12.125L33.0038 12.125C33.0019 12.125 33 12.125 33 15.125V12.125Z'
                        fill='#498FF8'
                      />
                    </g>
                  </g>
                  <path
                    d='M72.52 46.5V17.3H82C84.0267 17.3 85.7867 17.6867 87.28 18.46C88.8 19.2333 89.9733 20.3267 90.8 21.74C91.6533 23.1267 92.08 24.7667 92.08 26.66V37.1C92.08 38.9667 91.6533 40.6067 90.8 42.02C89.9733 43.4333 88.8 44.54 87.28 45.34C85.7867 46.1133 84.0267 46.5 82 46.5H72.52ZM78.52 40.9H82C83.2267 40.9 84.2133 40.5533 84.96 39.86C85.7067 39.1667 86.08 38.2467 86.08 37.1V26.66C86.08 25.54 85.7067 24.6333 84.96 23.94C84.2133 23.2467 83.2267 22.9 82 22.9H78.52V40.9ZM106.024 46.9C104.078 46.9 102.371 46.54 100.904 45.82C99.4644 45.0733 98.3444 44.0467 97.5444 42.74C96.771 41.4067 96.3844 39.86 96.3844 38.1V32.9C96.3844 31.14 96.771 29.6067 97.5444 28.3C98.3444 26.9667 99.4644 25.94 100.904 25.22C102.371 24.4733 104.078 24.1 106.024 24.1C107.971 24.1 109.651 24.4733 111.064 25.22C112.504 25.94 113.611 26.9667 114.384 28.3C115.184 29.6067 115.584 31.14 115.584 32.9V36.9H102.104V38.1C102.104 39.4867 102.438 40.54 103.104 41.26C103.771 41.9533 104.771 42.3 106.104 42.3C107.038 42.3 107.784 42.14 108.344 41.82C108.931 41.5 109.318 41.06 109.504 40.5H115.384C114.904 42.42 113.811 43.9667 112.104 45.14C110.424 46.3133 108.398 46.9 106.024 46.9ZM109.864 33.82V32.82C109.864 31.46 109.544 30.42 108.904 29.7C108.291 28.98 107.331 28.62 106.024 28.62C104.718 28.62 103.731 28.9933 103.064 29.74C102.424 30.4867 102.104 31.54 102.104 32.9V33.5L110.264 33.42L109.864 33.82ZM126.249 46.5L119.049 24.5H125.249L128.929 36.86C129.142 37.6067 129.355 38.42 129.569 39.3C129.782 40.18 129.942 40.8867 130.049 41.42C130.182 40.8867 130.342 40.18 130.529 39.3C130.742 38.42 130.942 37.62 131.129 36.9L134.769 24.5H140.889L133.769 46.5H126.249ZM144.473 46.5V17.3H153.953C155.98 17.3 157.74 17.6867 159.233 18.46C160.753 19.2333 161.926 20.3267 162.753 21.74C163.606 23.1267 164.033 24.7667 164.033 26.66V37.1C164.033 38.9667 163.606 40.6067 162.753 42.02C161.926 43.4333 160.753 44.54 159.233 45.34C157.74 46.1133 155.98 46.5 153.953 46.5H144.473ZM150.473 40.9H153.953C155.18 40.9 156.166 40.5533 156.913 39.86C157.66 39.1667 158.033 38.2467 158.033 37.1V26.66C158.033 25.54 157.66 24.6333 156.913 23.94C156.166 23.2467 155.18 22.9 153.953 22.9H150.473V40.9ZM177.978 46.9C176.031 46.9 174.324 46.54 172.858 45.82C171.418 45.0733 170.298 44.0467 169.498 42.74C168.724 41.4067 168.338 39.86 168.338 38.1V32.9C168.338 31.14 168.724 29.6067 169.498 28.3C170.298 26.9667 171.418 25.94 172.858 25.22C174.324 24.4733 176.031 24.1 177.978 24.1C179.924 24.1 181.604 24.4733 183.018 25.22C184.458 25.94 185.564 26.9667 186.338 28.3C187.138 29.6067 187.538 31.14 187.538 32.9V36.9H174.058V38.1C174.058 39.4867 174.391 40.54 175.058 41.26C175.724 41.9533 176.724 42.3 178.058 42.3C178.991 42.3 179.738 42.14 180.298 41.82C180.884 41.5 181.271 41.06 181.458 40.5H187.338C186.858 42.42 185.764 43.9667 184.058 45.14C182.378 46.3133 180.351 46.9 177.978 46.9ZM181.818 33.82V32.82C181.818 31.46 181.498 30.42 180.858 29.7C180.244 28.98 179.284 28.62 177.978 28.62C176.671 28.62 175.684 28.9933 175.018 29.74C174.378 30.4867 174.058 31.54 174.058 32.9V33.5L182.218 33.42L181.818 33.82ZM190.962 46.5L198.562 35.1L191.482 24.5H198.162L200.882 28.9C201.095 29.2467 201.295 29.6333 201.482 30.06C201.669 30.4867 201.815 30.8333 201.922 31.1C202.029 30.8333 202.175 30.4867 202.362 30.06C202.575 29.6333 202.775 29.2467 202.962 28.9L205.682 24.5H212.362L205.322 35.1L212.882 46.5H206.202L203.002 41.3C202.789 40.9267 202.575 40.54 202.362 40.14C202.175 39.7133 202.029 39.3667 201.922 39.1C201.815 39.3667 201.669 39.7133 201.482 40.14C201.295 40.54 201.095 40.9267 200.882 41.3L197.642 46.5H190.962Z'
                    fill='white'
                  />
                  <defs>
                    <filter
                      id='filter0_d_160_3'
                      x='-33.75'
                      y='-33.875'
                      width='133.5'
                      height='139.75'
                      filterUnits='userSpaceOnUse'
                      color-interpolation-filters='sRGB'
                    >
                      <feFlood
                        floodOpacity='0'
                        result='BackgroundImageFix'
                      />
                      <feColorMatrix
                        in='SourceAlpha'
                        type='matrix'
                        values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0'
                        result='hardAlpha'
                      />
                      <feOffset dy='4' />
                      <feGaussianBlur stdDeviation='25' />
                      <feComposite
                        in2='hardAlpha'
                        operator='out'
                      />
                      <feColorMatrix
                        type='matrix'
                        values='0 0 0 0 0.103938 0 0 0 0 0.204167 0 0 0 0 0.0876215 0 0 0 0.25 0'
                      />
                      <feBlend
                        mode='normal'
                        in2='BackgroundImageFix'
                        result='effect1_dropShadow_160_3'
                      />
                      <feBlend
                        mode='normal'
                        in='SourceGraphic'
                        in2='effect1_dropShadow_160_3'
                        result='shape'
                      />
                    </filter>
                    <clipPath id='clip0_160_3'>
                      <rect
                        width='64'
                        height='64'
                        fill='white'
                      />
                    </clipPath>
                  </defs>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    ),
    {
      width: 1200,
      height: 630,
    }
  )
}
